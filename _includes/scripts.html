<script type="module" src="{{ base_path }}/assets/js/main.min.js"></script>
<script nomodule src="{{ base_path }}/assets/js/main.min.js"></script>
{% include analytics.html %}

<script>
document.addEventListener("DOMContentLoaded", function() {
    const toggleBtn = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    const contentWrapper = document.getElementById("main-content-wrapper");
    const htmlEl = document.documentElement;
    const bodyEl = document.body;

    // --- 1. åˆå§‹åŒ–æ£€æŸ¥ ---
    if (htmlEl.classList.contains("dark") || localStorage.getItem("theme") === "dark") {
        htmlEl.classList.add("dark");
        bodyEl.classList.add("dark");
        if(themeIcon) { themeIcon.classList.remove("fa-sun"); themeIcon.classList.add("fa-moon"); }
    }

    // --- 2. æ»šåŠ¨ç‰¹æ•ˆé€»è¾‘ (å·²ä¿®æ”¹ï¼šæ—¥é—´æ¨¡å¼åªå˜æ¨¡ç³Šï¼Œä¸ä¾¿ç™½) ---
    function updateBackground() {
        if (!contentWrapper) return;
        
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        var progress = Math.min(scrollTop / 500, 1.0); 
        var isDark = htmlEl.classList.contains("dark");

        if (isDark) {
            // ã€å¤œé—´æ¨¡å¼ã€‘
            // å˜é»‘ + å¼ºæ¨¡ç³Š
            contentWrapper.style.backgroundColor = "rgba(0, 0, 0, " + (progress * 0.8) + ")";
            contentWrapper.style.backdropFilter = "blur(" + (progress * 15) + "px)";
            contentWrapper.style.webkitBackdropFilter = "blur(" + (progress * 15) + "px)";
        } else {
            // ã€æ—¥é—´æ¨¡å¼ã€‘(ğŸ”´ æ ¸å¿ƒä¿®æ”¹)
            // 1. é€æ˜åº¦ï¼šæœ€é«˜åªåˆ° 0.15 (15%çš„ç™½)ï¼Œä¿æŒæé«˜é€šé€æ„Ÿï¼Œç»ä¸å˜ç™½çº¸
            // 2. æ¨¡ç³Šåº¦ï¼šæœ€é«˜åˆ° 15px (ç£¨ç ‚æ„Ÿ)
            contentWrapper.style.backgroundColor = "rgba(255, 255, 255, " + (progress * 0.15) + ")";
            contentWrapper.style.backdropFilter = "blur(" + (progress * 15) + "px)";
            contentWrapper.style.webkitBackdropFilter = "blur(" + (progress * 15) + "px)";
        }
    }

    // ç»‘å®šæ»šåŠ¨äº‹ä»¶
    window.addEventListener("scroll", updateBackground);
    updateBackground();

    // --- 3. ç‚¹å‡»åˆ‡æ¢é€»è¾‘ ---
    if (toggleBtn) {
        toggleBtn.addEventListener("click", function(e) {
            e.preventDefault();
            htmlEl.classList.toggle("dark");
            bodyEl.classList.toggle("dark");

            if (htmlEl.classList.contains("dark")) {
                localStorage.setItem("theme", "dark");
                if(themeIcon) { themeIcon.classList.remove("fa-sun"); themeIcon.classList.add("fa-moon"); }
            } else {
                localStorage.setItem("theme", "light");
                if(themeIcon) { themeIcon.classList.remove("fa-moon"); themeIcon.classList.add("fa-sun"); }
            }
            
            updateBackground();
        });
    }
});
</script>

<script>
  window.MathJax = {
    tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
    options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
