<script type="module" src="{{ base_path }}/assets/js/main.min.js"></script>
<script nomodule src="{{ base_path }}/assets/js/main.min.js"></script>

{% include analytics.html %}

<script>
document.addEventListener("DOMContentLoaded", function() {
    const toggleBtn = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    const contentWrapper = document.getElementById("main-content-wrapper");
    const body = document.body;

    // --- A. 初始化：检查本地存储 ---
    if (localStorage.getItem("theme") === "dark") {
        body.classList.add("dark");
        if(themeIcon) { themeIcon.classList.remove("fa-sun"); themeIcon.classList.add("fa-moon"); }
    }

    // --- B. 滚动特效函数 (智能变色) ---
    function updateBackground() {
        if (!contentWrapper) return;
        
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        // 500px 距离达到最大不透明度 0.95
        var opacity = Math.min(scrollTop / 500, 0.95);
        var isDark = body.classList.contains("dark");

        if (isDark) {
            // 夜间模式：黑幕 (RGBA 0,0,0)
            contentWrapper.style.backgroundColor = "rgba(0, 0, 0, " + opacity + ")";
            // 夜间建议模糊稍微强一点
            contentWrapper.style.backdropFilter = "blur(" + (opacity * 15) + "px)"; 
        } else {
            // 日间模式：白雾 (RGBA 255,255,255)
            contentWrapper.style.backgroundColor = "rgba(255, 255, 255, " + opacity + ")";
            contentWrapper.style.backdropFilter = "blur(" + (opacity * 10) + "px)";
        }
    }

    // 绑定滚动事件
    window.addEventListener("scroll", updateBackground);
    // 初始化执行一次
    updateBackground();

    // --- C. 点击切换逻辑 ---
    if (toggleBtn) {
        toggleBtn.addEventListener("click", function(e) {
            e.preventDefault();
            
            // 切换 dark 类
            body.classList.toggle("dark");
            
            // 切换图标 和 存储设置
            if (body.classList.contains("dark")) {
                localStorage.setItem("theme", "dark");
                if(themeIcon) { themeIcon.classList.remove("fa-sun"); themeIcon.classList.add("fa-moon"); }
            } else {
                localStorage.setItem("theme", "light");
                if(themeIcon) { themeIcon.classList.remove("fa-moon"); themeIcon.classList.add("fa-sun"); }
            }
            
            // 立即更新背景颜色 (不用等滚动)
            updateBackground();
        });
    }
});
</script>

<script>
  window.MathJax = {
    tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
    options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
